/**
 * Created by Anthony on 31/08/2015.
 */
!function(){"use strict";function e(e,t,o,r,a){function n(e,t,o){e.gpu=o,e.hide=function(){t.hide(e.gpu.power)},e.cancel=function(){t.cancel()}}e.user={},e.roi={startDate:new Date},e.earnings={},e.electricity={price:.1293},e.network={hashrate:0,blockTime:0,ethPrice:1},e.gpus=[],e.currency=a.NUMBER_FORMATS.CURRENCY_SYM,e.currencies=[{name:"USD",sym:a.NUMBER_FORMATS.CURRENCY_SYM}],e.showSimpleToast=function(e){t.show(t.simple().content(e).position("bottom right").hideDelay(3e3))},e.selectGPU=function(){e.user.gpu.price&&(e.roi.capital=s(e.user.gpu.name),0===e.roi.capital&&(e.roi.capital=e.user.gpu.price)),e.computeProfits()},e.computeProfits=function(){var t=1e6*e.user.gpu.hashrate/(1e9*e.network.hashrate),o=60/e.network.blockTime,r=5*o,a=t*r,n=60*a,i=24*n,s=7*i,c=30*i,u=n*e.user.price.usd;e.user.gpu.costs&&(u-=e.user.gpu.costs);var l=24*u,p=7*l,m=30*l;e.earnings.tab=[],e.earnings.tab.push({label:"Per hour",eth:n,price:u}),e.earnings.tab.push({label:"Per day",eth:i,price:l}),e.earnings.tab.push({label:"Per week",eth:s,price:p}),e.earnings.tab.push({label:"Per month",eth:c,price:m,last:!0}),e.computeRoi()},e.loadGPUs=function(){r.get("./assets/json/gpus.json").success(function(t){e.gpus=t}).error(function(e,t){console.log("And we just got hit by a "+t+" !!!")})};var i=function(e,t){return t*e/1e3};e.computeEnergyCosts=function(){e.user.gpu&&(e.user.gpu.costs=e.user.electricity&&e.user.gpu.power?i(e.electricity.price,1)*e.user.gpu.power:void 0,e.computeProfits())},e.computeRoi=function(){e.roi.capital&&(e.roi.date=new Date(moment(e.roi.startDate).add(e.roi.capital/e.earnings.tab[1].price,"days").calendar()))};var s=function(e){return 0};e.resetGPU=function(){var t=e.user.gpu.hashrate;e.user.gpu={hashrate:t}},e.init=function(){r.get("http://coinmarketcap-nexuist.rhcloud.com/api/eth").success(function(t){e.network.market=t,c(t.price)}).error(function(t,o){e.showSimpleToast("Failed to load Network data from coinmarketcap-nexuist.rhcloud.com :-/"),console.log("And we just got hit by a "+o+" !!!"),e.user.price.usd=0}),r.get("https://etherchain.org/api/basic_stats").success(function(t){for(var o=0,r=0,a=t.data.blocks.length,n=0;a>n;n++)o+=t.data.blocks[n].blockTime,r+=t.data.blocks[n].difficulty;e.network.blockTime=o/a,e.network.hashrate=r/o*1e-9}).error(function(t,o){e.showSimpleToast("Failed to load Network data from coinmarketcap-nexuist.rhcloud.com :-/"),console.log("And we just got hit by a "+o+" HTTP status !!!"),e.network.blockTime=1,e.network.hashrate=2})};var c=function(t){e.user.price={},e.user.price.usd=parseFloat(t.usd,10)};e.reset=function(){e.user={},c(e.network.market.price),e.showSimpleToast("Hashrate reset")},e.showAdvanced=function(t){o.show({controller:n,templateUrl:"src/calculator/html/powersupply.tmpl.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,locals:{gpu:e.user.gpu}}).then(function(t){e.user.gpu.power=t,e.computeEnergyCosts(),e.status='You said the information was "'+t+'".'},function(){e.status="You cancelled the dialog."})},n.$inject=["$scope","$mdDialog","gpu"]}angular.module("calculator",["ngMaterial"]),angular.module("calculator",[]).controller("HomeCtrl",e),e.$inject=["$scope","$mdToast","$mdDialog","$http","$locale"]}(),angular.module("gulp").run(["$templateCache",function(e){e.put("app/calculator/html/powersupply.tmpl.html",'<md-dialog aria-label="Power Calculator"><form><md-dialog-content style="max-width:800px;max-height:810px;"><md-slider flex="30" min="25" max="500" ng-model="gpu.power" aria-label="Power supply" id="power-supply" class="md-primary"></md-slider><md-input-container><label>Max power consumption in Watt</label> <input type="number" ng-model="gpu.power" aria-controls="power-supply"></md-input-container></md-dialog-content><div class="md-actions" layout="row"><md-button ng-click="hide()">Ok</md-button></div></form></md-dialog>')}]);